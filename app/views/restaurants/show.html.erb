<div class="container mt-4"> 
  <a href="<%= root_path %>" class="btn btn-outline-secondary mb-3">‚¨Ö Back to Restaurants</a>

  <div class="card shadow-lg border-0 p-4 text-center restaurant-details">
    <div class="card-body">
      <h2 class="text-primary fw-bold"><%= @restaurant.name %></h2>
      <h5 class="text-muted"><i class="bi bi-geo-alt-fill"></i> Located at <%= @restaurant.location %></h5>
      
      <div class="rating-display my-3">
        <h4 class="fw-semibold">üìä Average Rating: <span id="average-rating" class="text-warning"><%= @restaurant.average_rating %></span> ‚≠ê</h4>
      </div>

      <hr>

      <h3 class="mt-4 text-dark">Rate this restaurant:</h3>
      <div id="star-rating" class="my-3" data-restaurant-id="<%= @restaurant.id %>">
        <% (1..5).each do |star| %>
          <a href="#" class="star-link fs-2 mx-1" data-value="<%= star %>">‚òÖ</a>
        <% end %>
      </div>
      
      <p id="rating-message" class="text-danger mt-2"></p>

      <button id="confirm-rating" class="btn btn-success rounded-pill px-4 mt-3" style="display: none;">
        ‚úÖ Confirm Rating
      </button>
    </div>
  </div>
</div>
<style>

/* Added Soft Gradient and Shadow */
  .restaurant-details {
    border-radius: 15px;
    box-shadow: 0px 8px 20px rgba(0, 0, 0, 0.15);
    background: linear-gradient(to bottom, #ffffff, #f0f0f0);
    padding: 30px;
    max-width: 600px;
    margin: auto;
  }

  /* Star Rating Enhancement */
  .star-link {
    font-size: 40px;
    text-decoration: none;
    color: gray;
    transition: color 0.3s ease-in-out, transform 0.2s ease-in-out;
    cursor: pointer;
  }

  .star-link:hover,
  .star-link.selected {
    color: gold;
    transform: scale(1.3);
  }

  /* Animated Confirm Button */
  .btn-success {
    background: linear-gradient(135deg, #28a745, #218838);
    border: none;
    transition: all 0.3s ease-in-out;
  }

  .btn-success:hover {
    background: #ffc107;
    transform: scale(1.05);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const stars = document.querySelectorAll(".star-link");
    const confirmButton = document.getElementById("confirm-rating");
    const restaurantId = document.getElementById("star-rating").getAttribute("data-restaurant-id");
    let selectedRating = 0; // Stores the selected rating

    function highlightStars(rating) {
      stars.forEach((star, index) => {
        star.classList.toggle("selected", index < rating);
      });
    }

    stars.forEach(star => {
      star.addEventListener("click", function (event) {
        event.preventDefault(); // Prevent default link action
        selectedRating = this.getAttribute("data-value");
        highlightStars(selectedRating);
        confirmButton.style.display = "block"; // Show confirm button
      });
    });

    confirmButton.addEventListener("click", function () {
      if (selectedRating === 0) {
        document.getElementById("rating-message").innerText = "‚ö† Please select a rating!";
        return;
      }

      console.log("üîÑ Sending rating:", selectedRating);

      fetch(`/restaurants/${restaurantId}/rate`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRF-Token": document.querySelector("meta[name='csrf-token']").getAttribute("content")
        },
        body: JSON.stringify({ rating: selectedRating })
      })
      .then(response => {
        console.log("üîÑ Response received:", response);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log("‚úÖ Data received:", data);
        document.getElementById("average-rating").innerText = data.average;
        document.getElementById("rating-message").innerText = "‚≠ê Thank you for rating!";
        confirmButton.style.display = "none"; // Hide button after submission
      })
      .catch(error => {
        console.error("‚ùå Error:", error);
        document.getElementById("rating-message").innerText = "‚ùå Error submitting rating. Please try again.";
      });
    });
  });
</script>
